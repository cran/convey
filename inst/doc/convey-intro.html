<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml">

<head>

<meta charset="utf-8">
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="pandoc" />

<meta name="viewport" content="width=device-width, initial-scale=1">

<meta name="author" content="Djalma Pessoa" />

<meta name="date" content="2016-06-23" />

<title>Introduction to convey</title>



<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>



<link href="data:text/css;charset=utf-8,body%20%7B%0Abackground%2Dcolor%3A%20%23fff%3B%0Amargin%3A%201em%20auto%3B%0Amax%2Dwidth%3A%20700px%3B%0Aoverflow%3A%20visible%3B%0Apadding%2Dleft%3A%202em%3B%0Apadding%2Dright%3A%202em%3B%0Afont%2Dfamily%3A%20%22Open%20Sans%22%2C%20%22Helvetica%20Neue%22%2C%20Helvetica%2C%20Arial%2C%20sans%2Dserif%3B%0Afont%2Dsize%3A%2014px%3B%0Aline%2Dheight%3A%201%2E35%3B%0A%7D%0A%23header%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0A%23TOC%20%7B%0Aclear%3A%20both%3B%0Amargin%3A%200%200%2010px%2010px%3B%0Apadding%3A%204px%3B%0Awidth%3A%20400px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Aborder%2Dradius%3A%205px%3B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Afont%2Dsize%3A%2013px%3B%0Aline%2Dheight%3A%201%2E3%3B%0A%7D%0A%23TOC%20%2Etoctitle%20%7B%0Afont%2Dweight%3A%20bold%3B%0Afont%2Dsize%3A%2015px%3B%0Amargin%2Dleft%3A%205px%3B%0A%7D%0A%23TOC%20ul%20%7B%0Apadding%2Dleft%3A%2040px%3B%0Amargin%2Dleft%3A%20%2D1%2E5em%3B%0Amargin%2Dtop%3A%205px%3B%0Amargin%2Dbottom%3A%205px%3B%0A%7D%0A%23TOC%20ul%20ul%20%7B%0Amargin%2Dleft%3A%20%2D2em%3B%0A%7D%0A%23TOC%20li%20%7B%0Aline%2Dheight%3A%2016px%3B%0A%7D%0Atable%20%7B%0Amargin%3A%201em%20auto%3B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dcolor%3A%20%23DDDDDD%3B%0Aborder%2Dstyle%3A%20outset%3B%0Aborder%2Dcollapse%3A%20collapse%3B%0A%7D%0Atable%20th%20%7B%0Aborder%2Dwidth%3A%202px%3B%0Apadding%3A%205px%3B%0Aborder%2Dstyle%3A%20inset%3B%0A%7D%0Atable%20td%20%7B%0Aborder%2Dwidth%3A%201px%3B%0Aborder%2Dstyle%3A%20inset%3B%0Aline%2Dheight%3A%2018px%3B%0Apadding%3A%205px%205px%3B%0A%7D%0Atable%2C%20table%20th%2C%20table%20td%20%7B%0Aborder%2Dleft%2Dstyle%3A%20none%3B%0Aborder%2Dright%2Dstyle%3A%20none%3B%0A%7D%0Atable%20thead%2C%20table%20tr%2Eeven%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Ap%20%7B%0Amargin%3A%200%2E5em%200%3B%0A%7D%0Ablockquote%20%7B%0Abackground%2Dcolor%3A%20%23f6f6f6%3B%0Apadding%3A%200%2E25em%200%2E75em%3B%0A%7D%0Ahr%20%7B%0Aborder%2Dstyle%3A%20solid%3B%0Aborder%3A%20none%3B%0Aborder%2Dtop%3A%201px%20solid%20%23777%3B%0Amargin%3A%2028px%200%3B%0A%7D%0Adl%20%7B%0Amargin%2Dleft%3A%200%3B%0A%7D%0Adl%20dd%20%7B%0Amargin%2Dbottom%3A%2013px%3B%0Amargin%2Dleft%3A%2013px%3B%0A%7D%0Adl%20dt%20%7B%0Afont%2Dweight%3A%20bold%3B%0A%7D%0Aul%20%7B%0Amargin%2Dtop%3A%200%3B%0A%7D%0Aul%20li%20%7B%0Alist%2Dstyle%3A%20circle%20outside%3B%0A%7D%0Aul%20ul%20%7B%0Amargin%2Dbottom%3A%200%3B%0A%7D%0Apre%2C%20code%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0Aborder%2Dradius%3A%203px%3B%0Acolor%3A%20%23333%3B%0Awhite%2Dspace%3A%20pre%2Dwrap%3B%20%0A%7D%0Apre%20%7B%0Aborder%2Dradius%3A%203px%3B%0Amargin%3A%205px%200px%2010px%200px%3B%0Apadding%3A%2010px%3B%0A%7D%0Apre%3Anot%28%5Bclass%5D%29%20%7B%0Abackground%2Dcolor%3A%20%23f7f7f7%3B%0A%7D%0Acode%20%7B%0Afont%2Dfamily%3A%20Consolas%2C%20Monaco%2C%20%27Courier%20New%27%2C%20monospace%3B%0Afont%2Dsize%3A%2085%25%3B%0A%7D%0Ap%20%3E%20code%2C%20li%20%3E%20code%20%7B%0Apadding%3A%202px%200px%3B%0A%7D%0Adiv%2Efigure%20%7B%0Atext%2Dalign%3A%20center%3B%0A%7D%0Aimg%20%7B%0Abackground%2Dcolor%3A%20%23FFFFFF%3B%0Apadding%3A%202px%3B%0Aborder%3A%201px%20solid%20%23DDDDDD%3B%0Aborder%2Dradius%3A%203px%3B%0Aborder%3A%201px%20solid%20%23CCCCCC%3B%0Amargin%3A%200%205px%3B%0A%7D%0Ah1%20%7B%0Amargin%2Dtop%3A%200%3B%0Afont%2Dsize%3A%2035px%3B%0Aline%2Dheight%3A%2040px%3B%0A%7D%0Ah2%20%7B%0Aborder%2Dbottom%3A%204px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Apadding%2Dbottom%3A%202px%3B%0Afont%2Dsize%3A%20145%25%3B%0A%7D%0Ah3%20%7B%0Aborder%2Dbottom%3A%202px%20solid%20%23f7f7f7%3B%0Apadding%2Dtop%3A%2010px%3B%0Afont%2Dsize%3A%20120%25%3B%0A%7D%0Ah4%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23f7f7f7%3B%0Amargin%2Dleft%3A%208px%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Ah5%2C%20h6%20%7B%0Aborder%2Dbottom%3A%201px%20solid%20%23ccc%3B%0Afont%2Dsize%3A%20105%25%3B%0A%7D%0Aa%20%7B%0Acolor%3A%20%230033dd%3B%0Atext%2Ddecoration%3A%20none%3B%0A%7D%0Aa%3Ahover%20%7B%0Acolor%3A%20%236666ff%3B%20%7D%0Aa%3Avisited%20%7B%0Acolor%3A%20%23800080%3B%20%7D%0Aa%3Avisited%3Ahover%20%7B%0Acolor%3A%20%23BB00BB%3B%20%7D%0Aa%5Bhref%5E%3D%22http%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0Aa%5Bhref%5E%3D%22https%3A%22%5D%20%7B%0Atext%2Ddecoration%3A%20underline%3B%20%7D%0A%0Acode%20%3E%20span%2Ekw%20%7B%20color%3A%20%23555%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Edt%20%7B%20color%3A%20%23902000%3B%20%7D%20%0Acode%20%3E%20span%2Edv%20%7B%20color%3A%20%2340a070%3B%20%7D%20%0Acode%20%3E%20span%2Ebn%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Efl%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Ech%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Est%20%7B%20color%3A%20%23d14%3B%20%7D%20%0Acode%20%3E%20span%2Eco%20%7B%20color%3A%20%23888888%3B%20font%2Dstyle%3A%20italic%3B%20%7D%20%0Acode%20%3E%20span%2Eot%20%7B%20color%3A%20%23007020%3B%20%7D%20%0Acode%20%3E%20span%2Eal%20%7B%20color%3A%20%23ff0000%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%0Acode%20%3E%20span%2Efu%20%7B%20color%3A%20%23900%3B%20font%2Dweight%3A%20bold%3B%20%7D%20%20code%20%3E%20span%2Eer%20%7B%20color%3A%20%23a61717%3B%20background%2Dcolor%3A%20%23e3d2d2%3B%20%7D%20%0A" rel="stylesheet" type="text/css" />

</head>

<body>




<h1 class="title toc-ignore">Introduction to convey</h1>
<h4 class="author"><em>Djalma Pessoa</em></h4>
<h4 class="date"><em>2016-06-23</em></h4>



<div id="library-convey" class="section level1">
<h1>Library convey</h1>
<p>The library convey aims at estimating measures of poverty and income concentration. There are already at least two libraries covering this subject: vardpoor and Laeken. The main difference between the library convey and these two is that the convey strongly hinges on the survey library.</p>
<p>Some measures of poverty and income concentration are defined by non-differentiable functions so that it is not possible to use Taylor linearization to estimate their variances. An alternative is to use <strong>Influence functions</strong> as described in Deville (1999) and Osier (2009). The library convey implements this methodology to work with <code>survey.design</code> objects and also with <code>svyrep.design</code> objects.</p>
<p>Some examples of these measures are:</p>
<ul>
<li><p>At-risk-of-poverty threshold: <span class="math display">\[
arpt=.60q_{.50}
\]</span> where <span class="math inline">\(q_{.50}\)</span> is the income median;</p></li>
<li><p>At-risk-of-poverty rate <span class="math display">\[
 arpr=\frac{\sum_U 1(y_i \leq arpt)}{N}.100
\]</span></p></li>
<li><p>Quintile share ratio</p></li>
</ul>
<p><span class="math display">\[
qsr=\frac{\sum_U 1(y_i&gt;q_{.80})}{\sum_U 1(y_i\leq q_{.20})}
\]</span></p>
<ul>
<li>Gini coefficient <span class="math display">\[
1+G=\frac{2\sum_U (r_i-1)y_i}{N\sum_Uy_i}
\]</span> where <span class="math inline">\(r_i\)</span> is the rank of <span class="math inline">\(y_i\)</span>.</li>
</ul>
<p>Note that it is not possible to use Taylor linearization for these measures because they depend on quantiles and the Gini is defined as a function of ranks. This could be done using the approach proposed by Deville (1999) based upon influence functions.</p>
<div id="influence-function" class="section level3">
<h3>Influence function</h3>
<p>Let <span class="math inline">\(U\)</span> be a population of size <span class="math inline">\(N\)</span> and <span class="math inline">\(M\)</span> be a measure that allocates mass one to the set composed by one unit, that is <span class="math inline">\(M(i)=M_i= 1\)</span> if <span class="math inline">\(i\in U\)</span> and <span class="math inline">\(M(i)=0\)</span> if <span class="math inline">\(i\notin U\)</span></p>
<p>Now, a population parameter <span class="math inline">\(\theta\)</span> can be expressed as a functional of <span class="math inline">\(M\)</span> <span class="math display">\[
\theta=T(M)
\]</span></p>
<p>Examples of such parameters are:</p>
<ul>
<li><p>Total: <span class="math display">\[Y=\sum_Uy_i=\sum_U y_iM_i=\int ydM=T(M)\]</span></p></li>
<li><p>Ratio of two totals: <span class="math display">\[R=\frac{Y}{X}=\frac{\int y dM}{\int x dM}=T(M)\]</span></p></li>
<li><p>Cumulative distribution function: <span class="math display">\[F(x)=\frac{\sum_U 1(y_i\leq x)}{N}=\frac{\int 1(y\leq x)dM}{\int{dM}}=T(M)\]</span></p></li>
</ul>
<p>To estimate these parameters from the sample, we replace the measure <span class="math inline">\(M\)</span> by the estimated measure <span class="math inline">\(\hat{M}\)</span> defined by: <span class="math inline">\(\hat{M}(i)=\hat{M}_i= w_i\)</span> if <span class="math inline">\(i\in s\)</span> and <span class="math inline">\(\hat{M}(i)=0\)</span> if <span class="math inline">\(i\notin s\)</span>.</p>
<p>The estimators of the population parameters can then be expressed as functional of the measure <span class="math inline">\(\hat{M}\)</span>.</p>
<ul>
<li><p>Total: <span class="math display">\[\hat{Y}=T(\hat{M})=\int yd\hat{M}=\sum_s w_iy_i\]</span></p></li>
<li><p>Ratio of totals: <span class="math display">\[\hat{R}=T(\hat{M})=\frac{\int y d\hat{M}}{\int x d\hat{M}}=\frac{\sum_s w_iy_i}{\sum_s w_ix_i}\]</span></p></li>
<li><p>Cumulative distribution function: <span class="math display">\[\hat{F}(x)=T(\hat{M})=\frac{\int 1(y\leq x)d\hat{M}}{\int{d\hat{M}}}=\frac{\sum_s w_i 1(y_i\leq x)}{\sum_s w_i}\]</span></p></li>
</ul>
</div>
<div id="the-variance-estimator" class="section level2">
<h2>The variance estimator</h2>
<p>The variance of the estimator <span class="math inline">\(T(\hat{M})\)</span> can approximated by:</p>
<p><span class="math display">\[ 
Var\left[T(\hat{M})\right]\cong var\left[\sum_s w_i z_i\right]
\]</span></p>
<p>The <code>linearized</code> variable <span class="math inline">\(z\)</span> is given by the derivative of the functional:</p>
<p><span class="math display">\[
z_k=lim_{t\rightarrow0}\frac{T(M+t\delta_k)-T(M)}{t}=IT_k(M)
\]</span> where, <span class="math inline">\(\delta_k\)</span> is the Dirac measure in <span class="math inline">\(k\)</span>: <span class="math inline">\(\delta_k(i)=1\)</span> if and only if <span class="math inline">\(i=k\)</span>.</p>
<p>This <strong>derivative</strong> is called <strong>Influence Function</strong> and was introduced in the area of <strong>Robust Statistics</strong>.</p>
<div id="influence-functions---examples" class="section level3">
<h3>Influence functions - Examples</h3>
<ul>
<li><p>Total: <span class="math display">\[
\begin{align}
IT_k(M)&amp;=lim_{t\rightarrow 0}\frac{T(M+t\delta_k)-T(M)}{t}\\
&amp;=lim_{t\rightarrow 0}\frac{\int y.d(M+t\delta_k)-\int y.dM}{t}\\
&amp;=lim_{t\rightarrow 0}\frac{\int yd(t\delta_k)}{t}=y_k  
\end{align}
\]</span></p></li>
<li><p>Ratio of two totals: <span class="math display">\[
\begin{align}
IR_k(M)&amp;=I\left(\frac{U}{V}\right)_k(M)=\frac{V(M)\times IU_k(M)-U(M)\times IV_k(M)}{V(M)^2}\\
&amp;=\frac{X y_k-Y x_k}{X^2}=\frac{1}{X}(y_k-Rx_k)
\end{align}
\]</span></p></li>
</ul>
</div>
<div id="linearization-by-influence-function---examples" class="section level3">
<h3>Linearization by influence function - Examples</h3>
<ul>
<li>At-risk-of-poverty threshold: <span class="math display">\[
arpt = 0.6\times m
\]</span> where <span class="math inline">\(m\)</span> is the median income.</li>
</ul>
<p><span class="math display">\[
z_k= -\frac{0.6}{f(m)}\times\frac{1}{N}\times\left[I(y_k\leq m-0.5) \right]
\]</span></p>
<ul>
<li>At-risk-of-poverty rate:</li>
</ul>
<p><span class="math display">\[
 arpr=\frac{\sum_U I(y_i \leq t)}{\sum_U w_i}.100
\]</span> <span class="math display">\[
z_k=\frac{1}{N}\left[I(y_k\leq t)-t\right]-\frac{0.6}{N}\times\frac{f(t)}{f(m)}\left[I(y_k\leq m)-0.5\right]
\]</span></p>
<p>where:</p>
<p><span class="math inline">\(N\)</span> - population size;</p>
<p><span class="math inline">\(t\)</span> - at-risk-of-poverty threshold;</p>
<p><span class="math inline">\(y_k\)</span> - income of person <span class="math inline">\(k\)</span>;</p>
<p><span class="math inline">\(m\)</span> - median income;</p>
<p><span class="math inline">\(f\)</span> - income density function;</p>
</div>
<div id="structure-of-the-library" class="section level3">
<h3>Structure of the library</h3>
<p>In the library convey, there are some basic functions that produces the linearized variables of some estimates that often enter in the definition of measures of concentration and poverty. For example the <code>quantile</code> which is linearized by the function <code>svyiqalpha</code>. Other example is the function <code>svyisq</code> that linearizes the total below a quantile of the variable.</p>
<p>From the linearized variables of these basic estimates it is possible by using rules of composition, valid for influence functions, to derive the influence function of more complex estimates. By definition the influence function is a Gateaux derivative and the rules rules of composition valid for Gateaux derivatives also hold for Influence Functions.</p>
<p>The following property of Gateaux derivatives was often used in the library convey. Let <span class="math inline">\(g\)</span> be a differentible function of <span class="math inline">\(m\)</span> variables. Suppose we want to compute the influence function of the estimator <span class="math inline">\(g(T_1, T_2,\ldots, T_m)\)</span>, knowing the Influence function of the estimators <span class="math inline">\(T_i, i=1,\ldots, m\)</span>. Then the following holds:</p>
<p><span class="math display">\[
I(g(T_1, T_2,\ldots, T_m)) = \sum_{i=1}^m \frac{\partial g}{\partial T_i}I(T_i)
\]</span></p>
<p>In the library convey this rule is implemented by the function <code>contrastinf</code> which uses the R function <code>deriv</code> to compute the formal partial derivatives <span class="math inline">\(\frac{\partial g}{\partial T_i}\)</span>.</p>
<p>For example, suppose we want to linearize the <code>Relative median poverty gap</code>(rmpg), defined as the difference between the at-risk-of-poverty threshold (<code>arpt</code>) and the median of incomes less than the <code>arpt</code> relative to the <code>arprt</code>:</p>
<p><span class="math display">\[
rmpg= \frac{arpt-medpoor} {arpt}
\]</span></p>
<p>where <code>medpoor</code> is the median of incomes less than <code>arpt</code>.</p>
<p>Suppose we know how to linearize <code>arpt</code> and <code>medpoor</code>, then by applying the function <code>contrastinf</code> with <span class="math display">\[
g(T_1,T_2)= \frac{(T_1 - T_2)}{T_1}
\]</span> we linearize the <code>rmpg</code>.</p>
</div>
<div id="examples-of-use-of-the-library-convey" class="section level3">
<h3>Examples of use of the library convey</h3>
<p>In the following examples we will use the data set <code>eusilc</code> contained in the libraries <code>vardpoor</code> and <code>Laeken</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(vardpoor)
<span class="kw">data</span>(eusilc)</code></pre></div>
<p>Next, we create an object of class <code>survey.design</code> using the function <code>svydesign</code> of the library survey:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(survey)
des_eusilc &lt;-<span class="st"> </span><span class="kw">svydesign</span>(<span class="dt">ids =</span> ~rb030, <span class="dt">strata =</span>~db040,  <span class="dt">weights =</span> ~rb050, <span class="dt">data =</span> eusilc)</code></pre></div>
<p>Right after the creation of the design object <code>des_eusilc</code>, we should use the function <code>convey_prep</code> that adds an attribute to the survey design which saves information on the design object based upon the whole sample, needed to work with subset designs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(convey)
des_eusilc &lt;-<span class="st"> </span><span class="kw">convey_prep</span>( des_eusilc )</code></pre></div>
<pre><code>## preparing your full survey design to work with R convey package functions
## 
note that this function must be run on the full survey design object immediately after the svydesign() or svrepdesign() call.
## </code></pre>
<p>To estimate the <code>at-risk-of-poverty rate</code> we use the function <code>svyarpt</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyarpr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc)</code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0028</code></pre>
<p>To estimate the <code>at-risk-of-poverty rate</code> for domains defined by the variable <code>db040</code> we use</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc, <span class="dt">FUN =</span> svyarpr, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040  eqIncome se.eqIncome
Burgenland       Burgenland 0.1953984 0.017202243
Carinthia         Carinthia 0.1308627 0.010610622
Lower Austria Lower Austria 0.1384362 0.006517660
Salzburg           Salzburg 0.1378734 0.011579280
Styria               Styria 0.1437464 0.007452360
Tyrol                 Tyrol 0.1530819 0.009880430
Upper Austria Upper Austria 0.1088977 0.005928336
Vienna               Vienna 0.1723468 0.007682826
Vorarlberg       Vorarlberg 0.1653731 0.013754670</code></pre>
<p>Using the same data set, we estimate the <code>quintile share ratio</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for the whole population</span>
<span class="kw">svyqsr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc, <span class="dt">alpha=</span> .<span class="dv">20</span>)</code></pre></div>
<pre><code>          qsr     SE
eqIncome 3.97 0.0426</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># for domains</span>
<span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc,
  <span class="dt">FUN =</span> svyqsr, <span class="dt">alpha=</span> .<span class="dv">20</span>, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040 eqIncome se.eqIncome
Burgenland       Burgenland 5.008486  0.32755685
Carinthia         Carinthia 3.562404  0.10909726
Lower Austria Lower Austria 3.824539  0.08783599
Salzburg           Salzburg 3.768393  0.17015086
Styria               Styria 3.464305  0.09364800
Tyrol                 Tyrol 3.586046  0.13629739
Upper Austria Upper Austria 3.668289  0.09310624
Vienna               Vienna 4.654743  0.13135731
Vorarlberg       Vorarlberg 4.366511  0.20532075</code></pre>
<p>These functions can be used as S3 methods for the classes <code>survey.design</code> and <code>svyrep.design</code>.</p>
<p>Let’s create a design object of class <code>svyrep.design</code> and run the function <code>convey_prep</code> on it:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">des_eusilc_rep &lt;-<span class="st"> </span><span class="kw">as.svrepdesign</span>(des_eusilc, <span class="dt">type =</span> <span class="st">&quot;bootstrap&quot;</span>)
des_eusilc_rep &lt;-<span class="st"> </span><span class="kw">convey_prep</span>(des_eusilc_rep) </code></pre></div>
<pre><code>## preparing your full survey design to work with R convey package functions
## 
note that this function must be run on the full survey design object immediately after the svydesign() or svrepdesign() call.
## </code></pre>
<p>and then use the function <code>svyarpr</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyarpr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc_rep)</code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0026</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyby</span>(~eqIncome, <span class="dt">by =</span> ~db040, <span class="dt">design =</span> des_eusilc_rep, <span class="dt">FUN =</span> svyarpr, <span class="dt">deff =</span> <span class="ot">FALSE</span>)</code></pre></div>
<pre><code>                      db040  eqIncome se.eqIncome
Burgenland       Burgenland 0.1953984 0.015948955
Carinthia         Carinthia 0.1308627 0.009369766
Lower Austria Lower Austria 0.1384362 0.006378286
Salzburg           Salzburg 0.1378734 0.012678287
Styria               Styria 0.1437464 0.007245318
Tyrol                 Tyrol 0.1530819 0.010223210
Upper Austria Upper Austria 0.1088977 0.005749901
Vienna               Vienna 0.1723468 0.008765321
Vorarlberg       Vorarlberg 0.1653731 0.014346126</code></pre>
<p>The functions of the library convey are called in a similar way to the functions in library survey.</p>
<p>It is also possible to deal with missing values by using the argument <code>na.rm</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># survey.design using a variable with missings</span>
<span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc )</code></pre></div>
<pre><code>       gini SE
py010n   NA NA</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc , <span class="dt">na.rm =</span> <span class="ot">TRUE</span> )</code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0036</code></pre>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># svyrep.design using a variable with missings</span>
<span class="co"># svygini( ~ py010n , design = des_eusilc_rep ) get error</span>
<span class="kw">svygini</span>( ~<span class="st"> </span>py010n , <span class="dt">design =</span> des_eusilc_rep , <span class="dt">na.rm =</span> <span class="ot">TRUE</span> )</code></pre></div>
<pre><code>          gini     SE
py010n 0.64606 0.0041</code></pre>
</div>
<div id="fgt-indicator" class="section level3">
<h3>FGT indicator</h3>
<p>Foster and all(1984) proposed a family of indicators to measure poverty.</p>
<p>The class of <span class="math inline">\(FGT\)</span> measures, can be defined as</p>
<p><span class="math display">\[
p=\frac{1}{N}\sum_{k\in U}h(y_{k},\theta ), 
\]</span></p>
<p>where</p>
<p><span class="math display">\[
h(y_{k},\theta )=\left[ \frac{(\theta -y_{k})}{\theta }\right] ^{\gamma
}\delta \left\{ y_{k}\leq \theta \right\} , 
\]</span></p>
<p>where: <span class="math inline">\(\theta\)</span> is the poverty threshold; <span class="math inline">\(\delta\)</span> the indicator function that assigns value 1 if the condition <span class="math inline">\(\{y_{k}\leq \theta \}\)</span> is satisfied and 0 otherwise, and <span class="math inline">\(\gamma\)</span> is a non-negative constant.</p>
<p>When <span class="math inline">\(\gamma =0\)</span>, <span class="math inline">\(p\)</span> can be interpreted as the ratio of poor people, and for <span class="math inline">\(\gamma \geq 1\)</span>, the weight of poor people increases with the value <span class="math inline">\(\gamma\)</span>, (Foster and all, 1984).</p>
<p>The poverty measure FGT is implemented in the library convey by the function <code>svyfgt</code>. The argument <code>thresh_type</code> of this function defines the type of poverty threshold adopted. There are three possible choices:</p>
<ol style="list-style-type: decimal">
<li><code>abs</code> – fixed and given by the argument thresh_value</li>
<li><code>relq</code> – a proportion of a quantile fixed by the argument <code>proportion</code> and the quantile is defined by the argument <code>order</code>.</li>
<li><code>relm</code> – a proportion of the mean fixed the argument <code>proportion</code></li>
</ol>
<p>The quantile and the mean involved in the definition of the threshold are estimated for the whole population. When <span class="math inline">\(\gamma=0\)</span> and <span class="math inline">\(\theta= .6*MED\)</span> the measure is equal to the indicator <code>arpr</code> computed by the function <code>svyarpr</code>.</p>
<p>Next, we give some examples of the function <code>svyfgt</code> to estimate the values of the FGT poverty index.</p>
<p>Consider first the poverty threshold fixed (<span class="math inline">\(\gamma=0\)</span>) in the value <span class="math inline">\(10000\)</span>. The headcount ratio (FGT0) is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyfgt</span>(~eqIncome, des_eusilc, <span class="dt">g=</span><span class="dv">0</span>, <span class="dt">abs_thresh=</span><span class="dv">10000</span>)</code></pre></div>
<pre><code>            fgt0     SE
eqIncome 0.11444 0.0027</code></pre>
<p>The poverty gap (FGT1) (<span class="math inline">\(\gamma=1\)</span>) index for the poverty threshold fixed at the same value is</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyfgt</span>(~eqIncome, des_eusilc, <span class="dt">g=</span><span class="dv">1</span>, <span class="dt">abs_thresh=</span><span class="dv">10000</span>)</code></pre></div>
<pre><code>             fgt1     SE
eqIncome 0.032085 0.0011</code></pre>
<p>To estimate the FGT0 with the poverty threshold fixed at <span class="math inline">\(0.6* MED\)</span> we fix the argument type_thresh=“relq” and use the default values for <code>percent</code> and <code>order</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyfgt</span>(~eqIncome, des_eusilc, <span class="dt">g=</span><span class="dv">0</span>, <span class="dt">type_thresh=</span> <span class="st">&quot;relq&quot;</span>)</code></pre></div>
<pre><code>            fgt0     SE
eqIncome 0.14444 0.0028</code></pre>
<p>that matches the estimate obtained by</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyarpr</span>(~eqIncome, <span class="dt">design=</span>des_eusilc, .<span class="dv">5</span>, .<span class="dv">6</span>)</code></pre></div>
<pre><code>            arpr     SE
eqIncome 0.14444 0.0028</code></pre>
<p>To estimate the poverty gap(FGT1) with the poverty threshold equal to <span class="math inline">\(0.6*MEAN\)</span> we use:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">svyfgt</span>(~eqIncome, des_eusilc, <span class="dt">g=</span><span class="dv">1</span>, <span class="dt">type_thresh=</span> <span class="st">&quot;relm&quot;</span>)</code></pre></div>
<pre><code>             fgt1     SE
eqIncome 0.051187 0.0012</code></pre>
</div>
<div id="references" class="section level3">
<h3>References</h3>
<p>Berger, Y.G. e C.J. Skinner (to be published) - Variance Estimation for a Low-Income Proportion.</p>
<p>Foster, K., J. Greer e E. Thornbecke (1984) - A Class of Decomposable Poverty Measure. Econometrica, 52, 761-766.</p>
<p>Guillaume Osier (2009). Variance estimation for complex indicators of poverty and inequality. , Vol.3, No.3, pp. 167-195, ISSN 1864-3361, URL .</p>
<p>Jean-Claude Deville (1999). Variance estimation for complex statistics and estimators: linearization and residual techniques. Survey Methodology, 25, 193-203, URL .</p>
<script type="text/x-mathjax-config">
   MathJax.Hub.Config({  "HTML-CSS": { minScaleAdjust: 125, availableFonts: [] }  });
</script>
</div>
</div>
</div>



<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
